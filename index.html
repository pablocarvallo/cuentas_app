<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Cuentas</title>

<link rel="manifest" href="manifest.json">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">
<link rel="apple-touch-icon" href="icon_cuentas.png">

<style>
body {
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
  margin: 12px;
  background: #fafafa;
  color: #111;
  font-size: 17px;
  line-height: 1.4;
}
h2 {
  margin-top: 24px;
  margin-bottom: 8px;
  font-size: 20px;
  font-weight: 600;
}
.table-container {
  background: white;
  border-radius: 12px;
  padding: 12px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.08);
  overflow-x: auto;
  margin-bottom: 24px;
}
table {
  width: 100%;
  border-collapse: collapse;
  font-size: 17px;
}
td, th {
  border-bottom: 1px solid #e5e5e5;
  padding: 6px 4px;
}
td:first-child, th:first-child {
  text-align: left;
}
td:not(:first-child), th:not(:first-child) {
  text-align: right;
}
tr:last-child td { border-bottom: none; }

/* Negritas solo para el cuadro principal de TC */
#tabla_tc tr:first-child td,
#tabla_tc tr:first-child th,
#tabla_tc tr:last-child td,
#tabla_tc tr:last-child th {
  font-weight: bold;
}
#tabla_tc td:first-child, #tabla_tc th:first-child {
  font-weight: bold;
}
</style>
</head>
<body>

<h2>Resumen</h2>
<div class="table-container"><table id="tabla_resumen"></table></div>

<h2>TC</h2>
<div class="table-container"><table id="tabla_tc"></table></div>

<h2>TC – detalle adicional</h2>
<div class="table-container"><table id="tabla_tc_detalle"></table></div>

<script>
function parseCSV(text) {
  const lines = text.trim().split("\n");
  return lines.map(line => {
    const values = [];
    let current = "";
    let insideQuotes = false;
    for (let i = 0; i < line.length; i++) {
      const c = line[i];
      if (c === '"' && line[i-1] !== '\\') insideQuotes = !insideQuotes;
      else if (c === ',' && !insideQuotes) {
        values.push(current.trim().replace(/^"|"$/g,""));
        current = "";
      } else current += c;
    }
    values.push(current.trim().replace(/^"|"$/g,""));
    return values;
  });
}

async function cargarResumen() {
  const url = "https://docs.google.com/spreadsheets/d/e/2PACX-1vT5uXYuDRWuBezPr8wkXCc07mT2DaJQxgYgw0z90JDlS58Io7efeB7KhUpOiALhBtjITBJnNUWJHEKt/pub?gid=189610331&single=true&output=csv";
  const resp = await fetch(url);
  const text = await resp.text();
  const rows = parseCSV(text);
  const slice = rows.slice(0,4).map(r => r.slice(3,7));
  document.getElementById("tabla_resumen").innerHTML =
    slice.map(row => "<tr>" + row.map(c => `<td>${c}</td>`).join("") + "</tr>").join("");
}

async function cargarTC() {
  const url = "https://docs.google.com/spreadsheets/d/e/2PACX-1vT5uXYuDRWuBezPr8wkXCc07mT2DaJQxgYgw0z90JDlS58Io7efeB7KhUpOiALhBtjITBJnNUWJHEKt/pub?gid=1170744574&single=true&output=csv";
  const resp = await fetch(url);
  const text = await resp.text();

  const rows = parseCSV(text);

  // Cuadro principal: filas 1–11, columnas A y última con datos
  const subset = rows.slice(0,11);
  const trimmed = subset.map(r => {
    let lastCol = r.length - 1;
    for (let i = r.length - 1; i >= 0; i--) {
      if (r[i] && r[i].trim() !== "") { lastCol = i; break; }
    }
    return [r[0] || "", r[lastCol] || ""];
  });
  document.getElementById("tabla_tc").innerHTML =
    trimmed.map(row => "<tr>" + row.map(c => `<td>${c}</td>`).join("") + "</tr>").join("");

  // Cuadro adicional: filas 13–15, columnas A–B
  const detalle = rows.slice(12,15).map(r => r.slice(0,2));
  document.getElementById("tabla_tc_detalle").innerHTML =
    detalle.map(row => "<tr>" + row.map(c => `<td>${c}</td>`).join("") + "</tr>").join("");
}

// Cargar al inicio y refrescar cada 5 minutos
cargarResumen();
cargarTC();
setInterval(() => { cargarResumen(); cargarTC(); }, 300000);
</script>
</body>
</html>
