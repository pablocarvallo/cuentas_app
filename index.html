<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Cuentas</title>

<link rel="manifest" href="manifest.json" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="default" />
<link rel="apple-touch-icon" href="icon_cuentas.png" />

<style>
:root{
  --azul:#4A90E2;
  --azul-10:#E8F1FC;
  --texto:#111;
  --borde:#e5e5e5;
}
*{box-sizing:border-box}
body{
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,sans-serif;
  margin:0; background:#fafafa; color:var(--texto);
  font-size:17px; line-height:1.4; padding-bottom:80px;
}
h2{margin:16px 12px 8px; font-size:20px; font-weight:600}
.table-container{
  background:#fff; border-radius:12px; padding:12px; margin:0 12px 16px;
  box-shadow:0 2px 8px rgba(0,0,0,.08); overflow-x:auto;
}
table{width:100%; border-collapse:collapse; font-size:17px}
td,th{border-bottom:1px solid var(--borde); padding:6px 4px}
tr:last-child td{border-bottom:none}

/* Alineación general */
td:first-child, th:first-child{ text-align:left }
td:not(:first-child), th:not(:first-child){ text-align:right }

/* TC principal */
#tabla_tc tr:first-child td,
#tabla_tc tr:first-child th,
#tabla_tc tr:last-child td,
#tabla_tc tr:last-child th{ font-weight:700 }
#tabla_tc td:first-child, #tabla_tc th:first-child{ font-weight:700 }

/* GAS: primera columna derecha y negrita */
#tabla_gas td:first-child, #tabla_gas th:first-child{
  text-align:left; font-weight:700;
}
#tabla_gas td:not(:first-child), #tabla_gas th:not(:first-child){
  text-align:right; font-weight:400;
}

/* Barra inferior */
.tabbar{
  position:fixed; left:0; right:0; bottom:0;
  height:64px;
  display:flex; justify-content:space-around; align-items:center;
  background:#fff; border-top:1px solid var(--borde);
  z-index:10;
  padding-bottom: calc(env(safe-area-inset-bottom) + 20px);
  box-shadow: 0 -2px 6px rgba(0,0,0,0.05);
}
.tabbtn{
  flex:1; height:100%; display:flex; flex-direction:column;
  justify-content:center; align-items:center; gap:4px;
  color:#555; text-decoration:none; font-size:12px;
}
.tabbtn svg{ width:22px; height:22px; stroke:#777; transition:stroke .2s ease }
.tabbtn.active{ color:var(--azul); background:var(--azul-10) }
.tabbtn.active svg{ stroke:var(--azul) }

/* Transiciones laterales */
.container {
  position: relative;
  overflow: hidden;
}
.view {
  position: absolute;
  top: 0; left: 0;
  width: 100%; transition: transform 0.35s ease;
  opacity: 0; pointer-events: none;
}
.view.active {
  opacity: 1; pointer-events: auto;
  transform: translateX(0);
  z-index: 1;
}
.view.slide-in-left  { transform: translateX(100%); }
.view.slide-in-right { transform: translateX(-100%); }
</style>
</head>
<body>

<div class="container">
  <!-- VISTA 1: Resumen -->
  <div id="view-resumen" class="view active">
    <h2>Resumen</h2>
    <div class="table-container"><table id="tabla_resumen"></table></div>
  </div>

  <!-- VISTA 2: TC -->
  <div id="view-tc" class="view">
    <h2>TC</h2>
    <div class="table-container"><table id="tabla_tc"></table></div>

    <h2>TC – detalle adicional</h2>
    <div class="table-container"><table id="tabla_tc_detalle"></table></div>
  </div>

  <!-- VISTA 3: Gas -->
  <div id="view-gas" class="view">
    <h2>Gas</h2>
    <div class="table-container"><table id="tabla_gas"></table></div>
  </div>
</div>

<!-- Barra inferior -->
<nav class="tabbar" role="tablist" aria-label="Navegación principal">
  <button class="tabbtn active" data-target="view-resumen">
    <svg viewBox="0 0 24 24" fill="none" stroke-width="2"><path d="M3 9.5 12 3l9 6.5v9A2.5 2.5 0 0 1 18.5 21h-13A2.5 2.5 0 0 1 3 18.5z"/><path d="M9 21V12h6v9"/></svg>
    <span>Resumen</span>
  </button>
  <button class="tabbtn" data-target="view-tc">
    <svg viewBox="0 0 24 24" fill="none" stroke-width="2"><rect x="2" y="4" width="20" height="16" rx="2"/><path d="M2 9h20"/></svg>
    <span>TC</span>
  </button>
  <button class="tabbtn" data-target="view-gas">
    <svg viewBox="0 0 24 24" fill="none" stroke-width="2"><path d="M3 3v18h18"/><rect x="7" y="8" width="3" height="7"/><rect x="12" y="5" width="3" height="10"/><rect x="17" y="10" width="3" height="5"/></svg>
    <span>Gas</span>
  </button>
</nav>

<script>
const SHEET_BASE = "https://docs.google.com/spreadsheets/d/e/2PACX-1vT5uXYuDRWuBezPr8wkXCc07mT2DaJQxgYgw0z90JDlS58Io7efeB7KhUpOiALhBtjITBJnNUWJHEKt/pub";
const GID_RESUMEN = "189610331";
const GID_TC      = "1170744574";
const GID_GAS     = "724590671";

function csvUrl(gid){ return `${SHEET_BASE}?gid=${gid}&single=true&output=csv`; }
function parseCSV(text){
  const lines = text.trim().split("\n");
  return lines.map(line=>{
    const out=[], q='"'; let cur="", inQ=false;
    for(let i=0;i<line.length;i++){
      const c=line[i];
      if(c===q && line[i-1]!=='\\'){ inQ=!inQ; continue; }
      if(c===',' && !inQ){ out.push(cur.trim().replace(/^"|"$/g,"")); cur=""; continue; }
      cur+=c;
    }
    out.push(cur.trim().replace(/^"|"$/g,""));
    return out;
  });
}

// Tabs con animación
const tabs = document.querySelectorAll('.tabbtn');
const views = ["view-resumen","view-tc","view-gas"];
tabs.forEach((btn,i)=>{
  btn.addEventListener('click', ()=>cambiarVista(i));
});

let currentIndex = 0;
function cambiarVista(newIndex, dir=0){
  if(newIndex===currentIndex) return;
  const currentView=document.getElementById(views[currentIndex]);
  const nextView=document.getElementById(views[newIndex]);
  // Animación lateral
  const slideOutClass = dir>0 ? "slide-in-left" : "slide-in-right";
  const slideInClass  = dir>0 ? "slide-in-right" : "slide-in-left";
  currentView.classList.remove("active","slide-in-left","slide-in-right");
  nextView.classList.remove("slide-in-left","slide-in-right");
  nextView.classList.add(slideInClass,"active");
  nextView.style.transform="translateX("+(dir>0?"100%":"-100%")+")";
  requestAnimationFrame(()=>{
    nextView.style.transition="transform .35s ease, opacity .3s ease";
    nextView.style.transform="translateX(0)";
  });
  setTimeout(()=>{
    currentView.classList.remove("active");
    nextView.style.transition="";
  },350);
  tabs.forEach(b=>b.classList.remove("active"));
  tabs[newIndex].classList.add("active");
  currentIndex=newIndex;
}

// Cargas
async function cargarResumen(){
  const resp=await fetch(csvUrl(GID_RESUMEN));
  const rows=parseCSV(await resp.text());
  const slice=rows.slice(0,4).map(r=>r.slice(3,7));
  document.getElementById("tabla_resumen").innerHTML =
    slice.map(row=>"<tr>"+row.map(c=>`<td>${c}</td>`).join("")+"</tr>").join("");
}
async function cargarTC(){
  const resp=await fetch(csvUrl(GID_TC));
  const rows=parseCSV(await resp.text());
  const top=rows.slice(0,11);
  const principal=top.map(r=>{
    let last=r.length-1;
    for(let i=r.length-1;i>=0;i--){ if(r[i]&&r[i].trim()!==""){ last=i; break; }}
    return [r[0]||"", r[last]||""];
  });
  document.getElementById("tabla_tc").innerHTML =
    principal.map(row=>"<tr>"+row.map(c=>`<td>${c}</td>`).join("")+"</tr>").join("");
  const detalle=rows.slice(12,15).map(r=>r.slice(0,2));
  document.getElementById("tabla_tc_detalle").innerHTML =
    detalle.map(row=>"<tr>"+row.map(c=>`<td>${c}</td>`).join("")+"</tr>").join("");
}
async function cargarGas(){
  const resp=await fetch(csvUrl(GID_GAS));
  const rows=parseCSV(await resp.text());
  const top=rows.slice(0,5);
  const header=top[0]||[];
  let last=-1,prev=-1;
  for(let i=header.length-1;i>=1;i--){
    if(header[i]&&header[i].trim()!==""){ if(last===-1) last=i; else{prev=i; break;} }
  }
  if(last===-1) last=Math.max(1,header.length-1);
  if(prev===-1) prev=Math.max(1,last-1);
  const out=top.map(r=>{
    const cA=r[0]??"", cPrev=r[prev]??"", cLast=r[last]??"";
    return `<tr><td>${cA}</td><td>${cPrev}</td><td>${cLast}</td></tr>`;
  }).join("");
  document.getElementById("tabla_gas").innerHTML=out;
}

// Swipe lateral
let startX=0, startY=0;
const minDist=50;
document.addEventListener("touchstart",e=>{
  if(e.touches.length===1){ startX=e.touches[0].clientX; startY=e.touches[0].clientY; }
});
document.addEventListener("touchend",e=>{
  if(e.changedTouches.length===1){
    const dx=e.changedTouches[0].clientX-startX;
    const dy=e.changedTouches[0].clientY-startY;
    if(Math.abs(dx)>Math.abs(dy)&&Math.abs(dx)>minDist){
      let next=currentIndex;
      if(dx<0&&currentIndex<views.length-1) next=currentIndex+1;
      else if(dx>0&&currentIndex>0) next=currentIndex-1;
      if(next!==currentIndex){
        cambiarVista(next, dx<0?1:-1);
      }
    }
  }
});

// Carga inicial + refresco
cargarResumen(); cargarTC(); cargarGas();
setInterval(()=>{ cargarResumen(); cargarTC(); cargarGas(); },300000);
</script>
</body>
</html>
